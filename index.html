<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0b0b" />
  <link rel="manifest" href="manifest.json" />
  <title>Zarya Finance</title>

  <!-- Visual premium/dourado -->
  <style>
    :root{
      --bg:#0a0a0a; --bg2:#0f0f0f; --card:#121212; --border:#2a2216;
      --text:#f5f3e9; --muted:#bfb79e; --gold:#d4af37; --gold2:#b8952f; --gold3:#f3d46a;
      --btn:#15110a; --btnb:#3a2f16; --accentShadow: 0 0 0 1px rgba(212,175,55,.25), 0 8px 24px rgba(212,175,55,.15);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;margin:0;background:linear-gradient(180deg,#0a0a0a,#0d0d0d 15%,#0a0a0a);color:var(--text)}
    header{
      position:sticky;top:0;z-index:20;background:linear-gradient(180deg,rgba(212,175,55,.08),rgba(212,175,55,.02));
      border-bottom:1px solid var(--border); padding:14px 16px;
      backdrop-filter: blur(6px);
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:700; letter-spacing:.4px; font-size:18px;
    }
    .brand .badge{
      width:30px;height:30px;border-radius:10px;border:1px solid var(--gold2);
      display:grid;place-items:center;color:var(--gold);background:#0c0c0c; box-shadow: var(--accentShadow);
    }
    .brand .name{color:var(--gold)}
    main{padding:18px;max-width:1100px;margin:0 auto}
    nav{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0 20px}
    nav button{
      background:var(--btn);color:var(--gold);border:1px solid var(--btnb);
      border-radius:12px;padding:10px 14px;cursor:pointer;transition:transform .06s ease, box-shadow .2s ease;
    }
    nav button:hover{transform:translateY(-1px); box-shadow: var(--accentShadow);}
    nav button.active{
      background:linear-gradient(180deg, rgba(212,175,55,.18), rgba(212,175,55,.08));
      border-color:var(--gold2); color:#fff
    }
    section{display:none}
    section.active{display:block}

    .grid{display:grid;grid-template-columns:1.2fr 1fr; gap:14px}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }

    .card{
      background:radial-gradient(1200px 300px at -10% -10%, rgba(212,175,55,.04), transparent 60%) , var(--card);
      border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:14px; box-shadow: 0 1px 0 rgba(255,255,255,.02);
    }
    h3{margin:0 0 10px 0; font-size:16px}
    label{display:block;margin:8px 0 6px}
    input,textarea,select{
      width:100%;border:1px solid var(--border);background:#0e0e0e;color:var(--text);
      border-radius:10px;padding:10px
    }
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--border); padding:8px; text-align:left; font-size:14px}
    .muted{opacity:.9;font-size:12px;color:var(--muted)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row > *{flex:1 1 260px}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .btn{
      background:var(--btn);color:var(--gold);border:1px solid var(--btnb);
      border-radius:12px;padding:10px 14px;cursor:pointer; transition:transform .06s ease, box-shadow .2s ease;
    }
    .btn:hover{transform:translateY(-1px); box-shadow: var(--accentShadow);}
    .btn.primary{
      background:linear-gradient(180deg, rgba(212,175,55,.18), rgba(212,175,55,.08));
      border-color:var(--gold2); color:#fff
    }
    .pill{display:inline-block;padding:4px 8px;border:1px solid var(--gold2);border-radius:999px;color:var(--gold);font-size:12px}
    .empty{border:1px dashed var(--border);border-radius:12px;padding:16px;text-align:center;color:var(--muted)}
    .ok{color:#8de38d} .err{color:#ff8f8f}
    /* QR Reader box */
    #qr-reader{width:100%; min-height:320px; border:1px solid var(--border); border-radius:12px; overflow:hidden; background:#000;}
    footer{opacity:.8;color:#a9a28a;text-align:center;padding:16px}
    a{color:var(--gold)}

    
    .kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:14px}
    .kpi{background:linear-gradient(180deg, rgba(212,175,55,.10), rgba(212,175,55,.04));border:1px solid var(--gold2);border-radius:14px;padding:12px}
    .kpi h4{margin:0 0 6px 0;font-size:13px;color:#f7f3e4;opacity:.95}
    .kpi .val{font-size:20px;font-weight:600;color:#f7f3e4}
  
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
    .chip{background:var(--btn);border:1px solid var(--btnb);color:var(--gold);border-radius:999px;padding:8px 12px;cursor:pointer;font-size:13px}
    .chip.active{background:linear-gradient(180deg, rgba(212,175,55,.22), rgba(212,175,55,.1)); border-color:var(--gold2); color:#f7f3e4}

    .range{display:flex;gap:8px;flex-wrap:wrap}
    .range input{max-width:170px}

  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="badge">Z</div>
      <div><span class="name">Zarya Finance</span><div class="muted">NFC-e + OFX • Relatórios</div></div>
    </div>
  </header>

  <main>
    <nav>
      <button data-tab="scan" class="active">Scanner NFC-e</button>
      <button data-tab="receipts">Notas</button>
      <button data-tab="import">Importar OFX</button>
      <button data-tab="txs">Lançamentos</button>
      <button data-tab="reports">Relatórios</button>
      <button data-tab="settings">Config</button>
    </nav>


    <div class="chips" id="chipsPeriod">
      <span class="chip active" data-p="7d">7 dias</span>
      <span class="chip" data-p="30d">30 dias</span>
      <span class="chip" data-p="90d">90 dias</span>
      <span class="chip" data-p="ano">Ano</span>
      <span class="chip" data-p="tudo">Tudo</span>
      <span class="chip" data-p="custom">Custom</span>
      <span class="range" id="rangeCustom" style="display:none;">
        <input type="date" id="dtIni"><input type="date" id="dtFim">
        <button class="btn" id="btnApplyRange">Aplicar</button>
      </span>
    </div>
    
    <div class="kpis">
      <div class="kpi">
        <h4>Despesas (período)</h4>
        <div class="val" id="kpiOut">R$ 0,00</div>
      </div>
      <div class="kpi">
        <h4>Receitas (período)</h4>
        <div class="val" id="kpiIn">R$ 0,00</div>
      </div>
      <div class="kpi">
        <h4>Saldo (período)</h4>
        <div class="val" id="kpiNet">R$ 0,00</div>
      </div>
    </div>


    
    <!-- SCAN -->
    <section id="scan" class="active">
      <div class="grid">
        <div class="card">
          <h3>Leitor QR (html5-qrcode)</h3>
          <div id="qr-reader"></div>
          <div class="actions">
            <button id="btnStartQR" class="btn primary">Iniciar leitor</button>
            <button id="btnStopQR" class="btn">Parar</button>
          </div>
          <p id="scanStatus" class="muted">Status: inativo</p>
        </div>

        <div class="card">
          <h3>Colar URL do QR</h3>
          <label for="qrUrl">URL completa do QR da NFC-e</label>
          <input id="qrUrl" placeholder="https://...">
          <div class="actions">
            <button id="btnProcessUrl" class="btn">Processar URL</button>
          </div>
          <p class="muted">Dica: aponte a câmera nativa do celular para o QR, copie a URL e cole aqui.</p>
          <div class="empty">
            <div>Precisando: <span class="pill">Config → Endpoint do Parser (Apps Script)</span></div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Resultado</h3>
        <pre id="result" class="muted"></pre>
      </div>
      <canvas id="qrCanvas" style="display:none;"></canvas>
    </section>

    <!-- NOTAS -->
    <section id="receipts">
      <div class="card">
        <div class="actions">
          <button id="btnRefreshReceipts" class="btn">Atualizar</button>
          <button id="btnExportReceipts" class="btn">Exportar CSV</button>
        </div>
        <table id="tblReceipts">
          <thead><tr><th>Data</th><th>Emitente</th><th>Valor</th><th>Itens</th><th>UF</th></tr></thead>
          <tbody></tbody>
        </table>
        <div id="emptyReceipts" class="empty" style="display:none">Sem notas ainda. Escaneie um QR ou cole a URL para começar.</div>
      </div>
    </section>

    <!-- OFX -->
    <section id="import">
      <div class="card">
        <h3>Importar arquivo OFX (Santander/Bradesco)</h3>
        <label for="ofx">Selecione o arquivo .ofx</label>
        <input id="ofx" type="file" accept=".ofx">
        <div class="actions">
          <button id="btnImportOfx" class="btn primary">Importar</button>
          <button id="btnExportTxs" class="btn">Exportar CSV</button>
        </div>
        <p id="ofxStatus" class="muted">Nenhum arquivo enviado.</p>
      </div>
    </section>

    <!-- LANÇAMENTOS -->
    <section id="txs">
      <div class="card">
        <table id="tblTxs">
          <thead><tr><th>Data</th><th>Desc</th><th>Valor</th><th>Tipo</th></tr></thead>
          <tbody></tbody>
        </table>
        <div id="emptyTxs" class="empty" style="display:none">Sem lançamentos ainda. Importe OFX na aba “Importar OFX”.</div>
      </div>
    </section>

    <!-- RELATÓRIOS -->
    <section id="reports">
      <div class="card">
        <h3>Relatórios</h3>
        <div class="row">
          <div><canvas id="chartMes" height="260"></canvas></div>
          <div><canvas id="chartCat" height="260"></canvas></div>
        </div>
        <p class="muted">Dica: crie regras para classificar automaticamete (aba Config → Regras) e recarregue os relatórios.</p>
      </div>
    </section>

    <!-- CONFIG -->
    <section id="settings">
      <div class="card">
        <h3>Conexões & Preferências</h3>
        <label for="endpoint">Endpoint do Parser (Apps Script)</label>
        <input id="endpoint" placeholder="https://script.google.com/macros/s/AKfycb.../exec">
        <label for="uf">UF padrão (ex.: MG, SP...)</label>
        <input id="uf" placeholder="MG">

        <h3 style="margin-top:18px">Regras de categorização (regex)</h3>
        <div class="row">
          <div><label>Padrão</label><input id="rulePattern" placeholder="mercado|super|carrefour"></div>
          <div><label>Categoria</label><input id="ruleCat" placeholder="Supermercado"></div>
        </div>
        <div class="actions">
          <button id="btnAddRule" class="btn">Adicionar regra</button>
          <button id="btnSaveCfg" class="btn primary">Salvar Config</button>
          <button id="btnClearAll" class="btn">Apagar TUDO (local)</button>
        </div>
        <table id="tblRules"><thead><tr><th>Padrão</th><th>Categoria</th><th></th></tr></thead><tbody></tbody></table>
        <p class="muted">Dados salvos localmente (neste dispositivo). Podemos ativar sync depois (Supabase grátis).</p>
      </div>
    </section>
  </main>

  <footer>© Zarya Finance</footer>

  <!-- Bibliotecas -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>


  <!-- Charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- QR fallback -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>

  
  <!-- App scripts -->
  <script src="store.js"></script>
  <script src="ofx.js"></script>
  <script src="nfce.js"></script>
  <script src="main.js"></script>
</body>
</html>
